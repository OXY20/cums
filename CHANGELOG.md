# 更新日志

## v2.0.0 (2026-01-22)

### 🎉 重大版本更新

#### 架构优化
- **代码简化**: 主程序从 900+ 行精简至 664 行，提升可维护性
- **目录结构优化**: 移除 `cums/` 子目录，配置文件直接位于根目录
- **版本管理**: 版本号统一从 `config.json` 读取，便于管理

#### 新增功能
- ✨ **Web 管理后台**: 新增管理员后台功能，支持通过浏览器管理科目、班级、作业配置
  - 访问地址: `/admin`
  - 支持在线添加、修改科目和班级配置
  - 配置实时生效，无需重启
- ✨ **客户端主机名记录**: 上传日志中记录客户端主机名（通过反向DNS查询）
  - 日志格式: `[时间] 班级 学号姓名 提交 科目-作业 IP:xxx.xxx.xxx.xxx 主机名:hostname`
  - 无法查询时显示"未知主机"
- ✨ **启动信息优化**: 启动时显示更详细的系统信息和使用指南
  - 显示管理后台状态和访问地址
  - 显示配置文件路径和修改方法
  - 优化控制台输出格式

#### 功能改进
- 🔧 **科目过滤**: 登录后只显示包含当前班级的科目
- 🔧 **班级快速选择**: 登录时支持班级快速选择
- 🔧 **配置验证**: 启动时验证配置文件版本号

#### 配置变更
- 新增 `admin_enabled`: 是否启用管理后台（默认: `false`）
- 新增 `admin_password`: 管理员密码（启用管理后台时必填）
- 移除 `upload_dir`: 统一使用 `uploads/` 目录

#### 文档更新
- 📚 更新所有文档以反映 v2.0.0 版本变更
- 📚 添加管理后台使用说明
- 📚 更新配置文档，说明新增配置项

### 配置示例
```json
{
    "version": "2.0.0",
    "server_addr": ":3000",
    "admin_enabled": true,
    "admin_password": "your_password",
    "subjects": {
        "数学": {
            "classes": ["一班", "二班"],
            "homeworks": ["第一章作业", "第二章作业"]
        }
    }
}
```

### 升级说明
- ⚠️ **配置文件位置变更**: 从 `cums/config.json` 移至根目录 `config.json`
- ⚠️ **静态文件位置变更**: 从 `cums/static/` 移至根目录 `static/`
- ⚠️ **上传目录位置变更**: 从 `cums/uploads/` 移至根目录 `uploads/`
- ⚠️ **日志目录位置变更**: 从 `cums/logs/` 移至根目录 `logs/`
- ✅ 首次运行会自动创建新的目录结构
- ✅ 建议备份旧版本数据后再升级

---

## v1.0.4 (2026-01-21)

### 🎉 重大更新
- **架构重构**: 采用以科目为中心的配置结构
- **灵活登录**: 支持多班级共用，学生可选择班级登录

### 新增功能
- ✨ 启动时显示详细配置信息（科目、班级、作业统计）
- ✨ 启动时显示已配置科目列表
- ✨ 显示配置文件路径和修改指南
- ✨ 自动检测并显示局域网访问地址
- 📱 优化控制台输出格式，使用图标增强可读性

### 优化
- 🔧 修复配置结构与代码不匹配问题
- 🔧 移除 `--class` 命令行参数，改为前端班级选择
- 🔧 统一前后端数据结构
- 📝 完善文档系统（README、CONFIG、API全面更新）

### 文档更新
- 📚 更新 README.md - 添加完整使用说明
- 📚 更新 CONFIG.md - 以科目为中心的配置说明
- 📚 更新 API.md - 完整的接口文档
- 📚 创建 TESTING.md - 测试指南
- 📚 更新 ISSUES.md - 标记已解决问题

### 配置示例
```json
{
    "subjects": {
        "数学": {
            "classes": ["一班", "二班"],
            "homeworks": ["第一章作业", "第二章作业"]
        }
    }
}
```

---

## v1.0.2 (2026-01-20)

### 新增功能
- 监听 0.0.0.0，支持局域网访问
- 端口自动检测，被占用时自动尝试下一个端口

### 优化
- 修复日志中重复显示"班"字
- 班级选择改为下拉菜单

---

## v1.0.1 (2026-01-20)

### 新增功能
- 文件上传日志记录
- 控制台输出：[时间] 班级 号数姓名 提交作业
- 日志文件保存到 cums/logs/cums.log

### 优化
- 自动创建 cums 数据目录
- 程序首次运行自动生成默认配置和静态文件

---

## v1.0.0 (2026-01-20)

### 新增功能
- 文件上传系统
- 班级/科目/作业配置管理
- 支持自定义存储路径

### 特性
- 简洁的登录界面
- 文件自动重命名：{作业名}_{学号}_{姓名}_{时间戳}.{扩展名}
- 同名文件自动添加时间戳后缀
- 跨平台支持（Windows/Linux/Mac）

### 配置
- 配置文件格式：JSON
- 端口：3000
- 默认上传目录：uploads/
