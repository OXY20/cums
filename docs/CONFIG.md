# 配置文件说明

系统使用 **JSON 格式**的配置文件，采用**以科目为中心**的架构设计。

## 📁 文件位置

程序首次运行会自动创建配置文件：

```
cums/
└── config.json          # 配置文件
```

或者在可执行文件同目录下：

```
cums.exe
cums/
└── config.json
```

---

## 🏗️ 配置结构（以科目为中心）

### 完整配置示例

```json
{
    "version": "1.0.3",
    "server_addr": ":3000",
    "upload_dir": "uploads",
    "subjects": {
        "数学": {
            "classes": ["一班", "二班", "三班"],
            "homeworks": ["第一章作业", "第二章作业", "期中考试", "期末考试"]
        },
        "语文": {
            "classes": ["一班", "二班"],
            "homeworks": ["作文1", "作文2", "阅读理解1", "阅读理解2"]
        },
        "英语": {
            "classes": ["一班", "二班", "三班"],
            "homeworks": ["听力练习1", "听力练习2", "单词测试", "口语测试"]
        },
        "物理": {
            "classes": ["一班"],
            "homeworks": ["实验报告", "习题集1", "习题集2"]
        },
        "化学": {
            "classes": ["二班"],
            "homeworks": ["实验报告", "元素周期表背诵", "方程式练习"]
        }
    }
}
```

---

## 📋 配置项说明

### 全局配置

| 字段 | 类型 | 必填 | 默认值 | 说明 |
|------|------|------|--------|------|
| `version` | string | 是 | "1.0.3" | 版本号（语义化版本） |
| `server_addr` | string | 是 | ":3000" | 服务器监听地址和端口 |
| `upload_dir` | string | 是 | "uploads" | 上传文件存储目录 |
| `subjects` | object | 是 | - | 科目配置（核心，见下文） |

### subjects 配置（核心）

每个科目包含以下字段：

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `classes` | array | 是 | 开设该科目的班级列表 |
| `homeworks` | array | 是 | 该科目的作业名称列表 |

**示例**：
```json
"数学": {
    "classes": ["一班", "二班"],           // 一班和二班开设数学课
    "homeworks": ["第一章作业", "第二章作业"]  // 数学有两项作业
}
```

---

## 🔧 配置修改指南

### 添加新科目

在 `subjects` 中添加新条目：

```json
"subjects": {
    "现有科目...": "...",
    "物理": {                              // ← 新增科目
        "classes": ["一班", "二班"],
        "homeworks": ["实验报告", "习题1"]
    }
}
```

### 添加新班级到现有科目

```json
"数学": {
    "classes": ["一班", "二班", "三班"],  // ← 添加"三班"
    "homeworks": ["第一章作业", "第二章作业"]
}
```

### 添加新作业到现有科目

```json
"数学": {
    "classes": ["一班", "二班"],
    "homeworks": ["第一章作业", "第二章作业", "期末复习"]  // ← 添加新作业
}
```

### 修改端口

```json
{
    "server_addr": ":8080"  // ← 修改为 8080 端口
}
```

> 💡 **提示**: 修改配置后需要**重启程序**才能生效

---

## 📂 文件存储规则

### 默认存储路径

文件按以下结构存储：

```
uploads/
├── {科目名}/
│   ├── {班级名}/
│   │   ├── {作业名}/
│   │   │   ├── {作业名}_{学号}_{姓名}_{时间戳}.{扩展名}
│   │   │   └── ...
```

**示例**：
```
uploads/
├── 数学/
│   ├── 一班/
│   │   ├── 第一章作业/
│   │   │   ├── 第一章作业_01_张三_20260121193000.docx
│   │   │   └── 第一章作业_02_李四_20260121193120.pdf
│   │   └── 第二章作业/
│   └── 二班/
│       └── 第一章作业/
├── 语文/
│   └── 一班/
└── 英语/
    └── 一班/
```

### 路径规则

1. **基础目录**: 由 `upload_dir` 指定（默认 `uploads`）
2. **科目目录**: 一级目录，按科目名称
3. **班级目录**: 二级目录，按班级名称
4. **作业目录**: 三级目录，按作业名称
5. **文件命名**: `{作业名}_{学号}_{姓名}_{时间戳}.{扩展名}`

---

## 🎯 配置设计理念

### 为什么采用"以科目为中心"？

1. **符合教学管理习惯**
   - 教师按科目布置和批改作业
   - 不同班级可以有相同或不同的科目
   - 便于科目级别的统一管理

2. **配置清晰简洁**
   - 每个科目独立配置
   - 避免重复配置
   - 易于理解和维护

3. **灵活的班级组合**
   - 同一科目可服务多个班级
   - 不同班级可有不同科目组合
   - 便于排课和教学管理

### 与"以班级为中心"的对比

| 维度 | 以科目为中心（当前） | 以班级为中心 |
|------|---------------------|-------------|
| **配置视角** | 教师管理科目 | 班级管理 |
| **配置重复** | 低 | 高 |
| **灵活性** | 高 | 中 |
| **适用场景** | 机房共用、排课灵活 | 固定班级 |
| **存储结构** | `科目/班级/作业/` | `班级/科目/作业/` |

---

## 🔍 配置查找规则

程序按以下顺序查找配置文件：

| 优先级 | 路径 |
|--------|------|
| 1 | `{可执行文件目录}/cums/config.json` |
| 2 | `./cums/config.json` |

**查找示例**：
```
# 场景1: 可执行文件在 C:\Users\ERSHI\code\cums\cums.exe
查找顺序:
  1. C:\Users\ERSHI\code\cums\cums\config.json
  2. C:\Users\ERSHI\code\cums\cums\config.json

# 场景2: 从源码运行 go run main.go
查找顺序:
  1. C:\Users\ERSHI\code\cums\cums\config.json
  2. C:\Users\ERSHI\code\cums\cums\config.json
```

---

## 🚀 首次运行

程序首次运行会自动：

1. ✅ 创建 `cums` 目录
2. ✅ 创建 `config.json`（使用默认配置）
3. ✅ 创建 `static/index.html`（前端页面）
4. ✅ 创建 `uploads` 目录结构
5. ✅ 创建 `logs` 目录

**默认配置**（首次运行自动生成）：

```json
{
    "version": "1.0.3",
    "server_addr": ":3000",
    "upload_dir": "uploads",
    "subjects": {
        "数学": {
            "classes": ["一班", "二班"],
            "homeworks": ["第一章作业", "第二章作业"]
        },
        "语文": {
            "classes": ["一班"],
            "homeworks": ["作文", "阅读理解"]
        },
        "英语": {
            "classes": ["一班"],
            "homeworks": ["听力练习"]
        }
    }
}
```

---

## 📝 配置最佳实践

### 1. 命名规范

- **科目名**: 使用中文全称（如：数学、语文、英语）
- **班级名**: 统一使用"一班"、"二班"等格式
- **作业名**: 描述性强，如"第一章作业"而非"作业1"

### 2. 组织建议

- 按教学实际情况配置
- 定期清理已结束的作业
- 保持配置的清晰和简洁

### 3. 版本管理

```json
{
    "version": "1.0.3"  // 建议跟随程序版本
}
```

---

## ⚠️ 注意事项

1. **JSON 格式**: 必须符合 JSON 规范（引号、逗号等）
2. **重启生效**: 修改配置后需要重启程序
3. **目录自动创建**: 配置中的目录不存在时会自动创建
4. **端口占用**: 如果端口被占用，程序会自动尝试下一个端口
5. **班级格式**: 支持"一班"和"1班"等格式（自动转换）

---

## 🔧 故障排查

### 配置文件未生效

**检查清单**:
- [ ] JSON 格式是否正确（可用在线工具验证）
- [ ] 是否修改了正确的配置文件
- [ ] 是否重启了程序
- [ ] 控制台是否显示配置信息

### 端口被占用

**现象**: 启动时显示端口被占用

**解决**:
- 方案1: 程序会自动尝试下一个端口
- 方案2: 修改 `server_addr` 为其他端口
- 方案3: 关闭占用端口的程序

### 目录未创建

**检查**:
- [ ] 程序是否有目录创建权限
- [ ] 磁盘空间是否充足
- [ ] 路径是否合法

---

## 📚 相关文档

- [快速开始](./README.md)
- [API 文档](./API.md)
- [系统架构](./ARCHITECTURE.md)
- [问题清单](./ISSUES.md)

---

**文档版本**: v1.0.3
**更新日期**: 2026-01-21
**状态**: ✅ 已更新为以科目为中心的架构
