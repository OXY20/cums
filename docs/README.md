# CUMS - 文件上传系统

一个简洁的机房文件上传系统，采用**以科目为中心**的架构设计。

## ✨ 功能特性

- 🎯 **以科目为中心**: 按科目管理班级和作业，符合教师使用习惯
- 🔐 **简洁登录**: 班级选择 + 学号姓名，无需复杂认证
- 📊 **级联选择**: 科目 → 班级 → 作业的流畅操作流程
- 📁 **智能存储**: 文件自动按 `uploads/科目/班级/作业/` 分类存储
- 🏷️ **自动命名**: `{作业名}_{学号}_{姓名}_{时间戳}.{扩展名}`
- 🌐 **局域网访问**: 支持学生机通过局域网地址访问
- 📝 **实时日志**: 控制台和文件双重日志记录
- 🔄 **自动初始化**: 首次运行自动创建配置和目录
- 💻 **跨平台**: 支持 Windows/Linux/macOS

## 🚀 快速开始

### 方式一：使用预编译版本（推荐）

1. 下载最新版本的 `cums.exe`（Windows）或 `cums`（Linux/Mac）
2. 双击运行或在终端执行：
   ```bash
   ./cums.exe
   ```
3. 浏览器访问控制台显示的地址

### 方式二：从源码运行

```bash
# 1. 克隆仓库
git clone https://github.com/OXY20/cums.git
cd cums

# 2. 运行程序
go run main.go

# 或者先编译
go build -o cums.exe .
./cums.exe
```

## 📖 使用说明

### 学生端操作

#### 1️⃣ 登录系统
- 点击"登录"按钮
- 从下拉列表选择班级
- 输入学号和姓名
- 点击"登录"完成

#### 2️⃣ 上传作业
- 选择科目（如：数学）
- 选择班级（自动过滤）
- 选择作业（如：第一章作业）
- 选择文件
- 点击"上传文件"

#### 3️⃣ 查看结果
- 上传成功后显示文件名
- 控制台实时显示上传记录
- 文件自动保存到对应目录

### 教师端管理

#### 🔧 管理员控制台（推荐）

访问 `/admin` 路由可进入 Web 管理界面，支持：
- ➕ 添加/删除科目
- ➕ 添加/删除班级
- ➕ 添加/删除作业
- 💾 修改后自动同步到配置文件

**启用管理员功能**：

1. 编辑 `config.json`，设置管理员密码并启用功能：
```json
{
    "admin_enabled": true,
    "admin_password": "your_password"
}
```

2. 重启程序后访问：`http://localhost:3000/admin`

3. 输入密码登录即可管理

> ⚠️ **安全提示**: 管理员功能默认关闭。密码以明文存储，请确保仅在可信网络环境使用。

#### 查看上传的文件
文件存储位置：
```
cums/uploads/
├── 数学/
│   ├── 一班/
│   │   ├── 第一章作业/
│   │   │   ├── 第一章作业_01_张三_20260121193000.docx
│   │   │   └── 第一章作业_02_李四_20260121193120.pdf
│   │   └── 第二章作业/
│   └── 二班/
├── 语文/
│   └── 一班/
└── 英语/
    └── 一班/
```

#### 手动修改配置
编辑 `cums/config.json` 文件（详见下文配置说明）

#### 查看日志
```
cums/logs/cums.log
```

日志格式：
```
[2026-01-21 19:30:00] 一班 01号张三提交第一章作业作业
```

## ⚙️ 配置说明

### 配置文件位置
首次运行自动创建：`cums/config.json`

### 配置结构（以科目为中心）

```json
{
    "version": "1.0.3",
    "server_addr": ":3000",
    "upload_dir": "uploads",
    "subjects": {
        "数学": {
            "classes": ["一班", "二班"],
            "homeworks": ["第一章作业", "第二章作业", "期中考试"]
        },
        "语文": {
            "classes": ["一班"],
            "homeworks": ["作文1", "阅读理解1"]
        },
        "英语": {
            "classes": ["一班", "二班"],
            "homeworks": ["听力练习", "单词测试"]
        }
    }
}
```

### 配置项说明

| 字段 | 类型 | 说明 | 示例 |
|------|------|------|------|
| `version` | string | 版本号 | "2.0.0" |
| `server_addr` | string | 服务器地址和端口 | ":3000" |
| `admin_enabled` | bool | 是否启用管理员功能 | false |
| `admin_password` | string | 管理员密码（明文） | "admin123" |
| `subjects` | object | 科目配置（核心） | 见下文 |

### subjects 配置详解

每个科目包含：
- `classes`: 开设该科目的班级列表
- `homeworks`: 该科目的作业列表

**添加新科目**：
```json
"物理": {
    "classes": ["一班", "二班"],
    "homeworks": ["实验报告", "习题集1"]
}
```

**添加新班级到现有科目**：
```json
"数学": {
    "classes": ["一班", "二班", "三班"],  // 添加"三班"
    "homeworks": ["第一章作业", "第二章作业"]
}
```

**添加新作业到现有科目**：
```json
"数学": {
    "classes": ["一班", "二班"],
    "homeworks": ["第一章作业", "第二章作业", "期末复习"]  // 添加新作业
}
```

> 💡 **提示**: 修改配置后需要重启程序生效

### 端口配置

如果默认端口 3000 被占用，程序会自动尝试下一个可用端口（3001、3002...）

或者直接修改 `config.json`：
```json
"server_addr": ":8080"
```

## 📂 程序运行后的目录结构

```
cums/                          # 程序所在目录
├── cums.exe                   # 可执行文件
├── cums/                      # 运行时生成
│   ├── config.json            # 配置文件
│   ├── static/
│   │   └── index.html         # 前端页面
│   ├── uploads/               # 上传文件目录
│   │   ├── 数学/
│   │   │   ├── 一班/
│   │   │   │   └── 第一章作业/
│   │   │   │       └── *.docx
│   │   │   └── 二班/
│   │   ├── 语文/
│   │   └── 英语/
│   └── logs/
│       └── cums.log           # 运行日志
```

## 🌐 访问地址

程序启动后控制台会显示：

```
========================================
🚀 服务器已启动
🌐 访问地址: http://localhost:3000
📡 局域网访问: http://192.168.1.100:3000
========================================
```

- **本机访问**: 使用 `localhost` 地址
- **学生机访问**: 使用局域网地址

## 📁 文件命名规则

上传文件自动重命名，格式：

```
{作业名}_{学号}_{姓名}_{时间戳}.{扩展名}
```

示例：
- `第一章作业_01_张三_20260121193000.docx`
- `听力练习_15_LiMing_20260121193120.mp3`

**优点**：
- ✅ 避免文件名冲突
- ✅ 包含完整的学生信息
- ✅ 按时间排序
- ✅ 易于识别和管理

## 🛠️ 开发相关

### 项目结构

```
cums/
├── docs/                # 文档目录
│   ├── README.md       # 本文档
│   ├── CONFIG.md       # 详细配置说明
│   ├── API.md          # API 文档
│   ├── ARCHITECTURE.md # 架构设计
│   └── TESTING.md      # 测试指南
├── static/             # 前端文件（运行时生成）
│   └── index.html      # 单页面应用
├── main.go             # 后端主程序
├── embed.go            # 嵌入文件
├── go.mod              # Go 模块定义
├── build/              # 构建脚本
│   └── build.sh        # 跨平台打包
└── build_and_run.bat   # 快速启动脚本
```

### 编译

```bash
# Windows
go build -o cums.exe .

# Linux
go build -o cums .

# macOS
go build -o cums .
```

### 跨平台打包

```bash
cd build
./build.sh
```

输出：
```
build/
├── windows/cums_1.0.3_20260121.exe
├── linux/cums_1.0.3_20260121
└── darwin/cums_1.0.3_20260121
```

## 📚 相关文档

- [配置详细说明](./CONFIG.md)
- [API 接口文档](./API.md)
- [系统架构设计](./ARCHITECTURE.md)
- [开发指南](./DEVELOPMENT.md)
- [部署指南](./DEPLOYMENT.md)
- [测试指南](./TESTING.md)
- [问题清单](./ISSUES.md)

## 📋 后期规划（TODO）

以下功能已列入开发计划，但尚未实装：

### 作业模板下载功能
- [ ] 为每次作业提供模板文件下载
- [ ] 学生下载模板 → 完成作业 → 提交

### 作业说明功能
- [ ] 为每次作业添加说明文字
- [ ] 支持为作业添加说明图片
- [ ] 在学生端显示作业要求和说明

### 配置结构扩展（规划中）
```json
{
    "subjects": {
        "数学": {
            "classes": ["一班", "二班"],
            "homeworks": [
                {
                    "name": "第一章作业",
                    "description": "完成课本第一章习题1-10",
                    "template": "templates/math_ch1.docx",
                    "images": ["images/example1.png"]
                }
            ]
        }
    }
}
```

> 💡 这些功能将在后续版本中逐步实装，敬请期待。

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

详细贡献指南请参考 [贡献指南](./CONTRIBUTING.md)。

## 📄 许可证

MIT License

---

**版本**: v2.1.0
**更新日期**: 2026-01-26
**状态**: ✅ 生产就绪（管理员功能已实装）
